ids.exclude<-ids.exclude[!is.na(ids.exclude)]
ids.exclude<-ids.exclude[!duplicated(ids.exclude)]
lengths(ids.exclude)
dim(d_2)
d_3<-d_2[!is.na(d_2$Age) ,]
#dim(d_3)
d_3<-d_3[!d_3$FIN%in%ids.exclude,]
d_4<-d_3%>%filter(!(Trauma.Type=="BURN" | Trauma.Type=="P" | Interfacility.Transfer=="Y"))
d_4$Trauma.Type
dim(d_2)
d$Trauma.Type
d$Trauma.Type[1:150]
dim(d)
dim(d_2)
d_2 <- d %>%
group_by(FIN) %>%
mutate(
tbi_c = ifelse(any(tbi == 1, na.rm = TRUE), 1, 0),
anyotherinj_c = ifelse(any(anyotherinj == 1, na.rm = TRUE), 1, 0),
othertrunkinj_c = ifelse(any(othertrunkinj == 1, na.rm = TRUE), 1, 0),
ais.gt.2 = ifelse(any(AIS.Severity > 2, na.rm = TRUE), 1, 0),
exclude = ifelse(any(substr(ICD.10.Injury.Diagnoses..after.2016., 1, 5) == "S06.A",
# & mdy(Injury.Date) >= as.Date("2016-01-01"),
na.rm = TRUE), 1, 0)
) %>%
ungroup()
dim(d_2)
d_2$Trauma.Type[1:150]
ids.exclude<-d_2$FIN[d_2$exclude==1]
ids.exclude<-ids.exclude[!is.na(ids.exclude)]
ids.exclude<-ids.exclude[!duplicated(ids.exclude)]
d_3<-d_2[!is.na(d_2$Age) ,]
d_3$Trauma.Type[1:150]
dim(d_3)
d_3<-d_2[!is.na(d_2$Injury.Date) ,]
dim(d_3)
#dim(d_3)
d_3<-d_3[!d_3$FIN%in%ids.exclude,]
d_4<-d_3%>%filter(!(Trauma.Type=="BURN" | Trauma.Type=="P" | Interfacility.Transfer=="Y"))
dim(d_4)
d_5$FIN[duplicated(d_5$FIN)]
length(unique(d_2$FIN))
length(unique(d_3$FIN))
length(unique(d_4$FIN))
length(unique(d_5$FIN))
d_5 <- d_4
d_5$FIN[duplicated(d_5$FIN)]
d_5<-d_5[!duplicated(d_5$FIN),]
length(unique(d_5$FIN))
d_all<-d_5
ais_vars<-d_all[, grepl("^Max", names(d_all))]
d_all$aisgt2 <- as.integer(rowSums(ais_vars > 2, na.rm = TRUE) > 0)
d_all$year<-year(d_all$Injury.Date)
d_all$year<-year(mdy(d_all$Injury.Date))
unique(d_all$year)
d_all<-d_all%>%mutate(tbiiso=ifelse(tbi_c==1 & anyotherinj_c==0,1,0), tbihs=ifelse(blood>3 & tbi_c==1 & othertrunkinj_c==1,1,0),hsonly=ifelse(tbi_c!=1 & blood>3 & othertrunkinj_c==1,1,0), notbinohs=ifelse(Calculated.ISS<15 & blood<=3 & tbi_c!=1,1,0),group=ifelse(tbiiso==1,1,ifelse(tbihs==1,2,ifelse(hsonly==1,3,ifelse(notbinohs==1,4,NA)))))
d_all%>%select(tbi_c,anyotherinj_c, blood,othertrunkinj_c,Calculated.ISS,Max.AIS.Head)%>%tbl_summary()
d_all$group.f<-factor(d_all$group,level = c(1,2,3,4),labels=c("Isolated TBI","TBI+HS","HS","Ortho"))
d_all%>%select(group.f)%>%tbl_summary()
d_all$group.f<-factor(d_all$group,level = c(1,2,3,4),labels=c("Isolated TBI","TBI+HS","HS","Ortho"))
d_all%>%select(group.f)%>%tbl_summary()
mean(c(84,87,100))
mean(c(84,87,99))
mean(c(84,87,98))
unique(d_all$ED.Eye)
d_check<-d_all%>%filter(is.na(group.f))%>%select(year,tbi_c,anyotherinj_c, blood,othertrunkinj_c,Calculated.ISS,Max.AIS.Head)
d_check %>%tbl_summary(missing="ifany")
rm(list=ls())
d_new <- read.csv("C:/Users/cpedroza/OneDrive - UTHealth Houston/Cox/FPA/Data/Data042524_WADE_UNIVERSAL_MRN.csv",skip = 8,na=c("","NA","UNK","unk","NOT"))
dim(d_new)
d_pull <- read.csv("C:/Users/cpedroza/OneDrive - UTHealth Houston/Cox/FPA/Data/Data042524_WADE_UNIVERSAL_FIN.csv",skip = 8,na=c("","NA","UNK","unk","NOT"))
dim(d_pull)
sum(as.Date(d_pull$`Injury Date`)< as.Date("2016-01-01"),na.rm = TRUE)
sum(as.Date(d_new$`Injury Date`)< as.Date("2016-01-01"),na.rm = TRUE)
sum(as.Date(d_new$Injury.Date)< as.Date("2016-01-01"),na.rm = TRUE)
sum(as.Date(d_pull$Injury.Date)< as.Date("2016-01-01"),na.rm = TRUE)
sum(mdy(d_pull$Injury.Date)< as.Date("2016-01-01"),na.rm = TRUE)
sum(mdy(d_new$Injury.Date)< as.Date("2016-01-01"),na.rm = TRUE)
d_new <- d_new %>%
fill(MRN,FIN, .direction = "down")
d_pull <- d_pull %>%
fill(MRN,FIN, .direction = "down")
d_new<- d_new %>%
rename(
Max.AIS.Head = Max.Head.AIS.code,
Max.AIS.Face = Max.Face.AIS.Code,
Max.AIS.Neck = Max.Neck.AIS,
Max.AIS.Chest = Max.Chest.AIS,
Max.AIS.Abdomen = Max.Abdomen.AIS,
Max.AIS.Spine = Max.Spine.AIS,
Max.AIS.Upper.Extremity = Max.Upper.Extremity.AIS,
Max.AIS.Lower.Extremity = Max.Lower.Extremity.AIS,
Max.AIS.External = Max.External.AIS
)
d_pull<- d_pull %>%
rename(
Max.AIS.Head = Max.Head.AIS.code,
Max.AIS.Face = Max.Face.AIS.Code,
Max.AIS.Neck = Max.Neck.AIS,
Max.AIS.Chest = Max.Chest.AIS,
Max.AIS.Abdomen = Max.Abdomen.AIS,
Max.AIS.Spine = Max.Spine.AIS,
Max.AIS.Upper.Extremity = Max.Upper.Extremity.AIS,
Max.AIS.Lower.Extremity = Max.Lower.Extremity.AIS,
Max.AIS.External = Max.External.AIS
)
d_join <- d_pull
joined_data <- rbind(d_join,d_new)
d <- joined_data
numeric_columns <- names(d_pull)[sapply(d_pull, is.numeric)]
d <- d %>%
mutate(across(all_of(numeric_columns), as.numeric))
dim(d)
d$tbi<-ifelse(d$ISS.Body.Region=='HEAD' & !is.na(d$AIS.Severity) & d$AIS.Severity != 9 &  d$AIS.Severity>2,1,ifelse(d$ISS.Body.Region=='HEAD' & !is.na(d$AIS.Severity) & d$AIS.Severity != 9 &  d$AIS.Severity<=2,0,NA))
d$anyotherinj<-ifelse( d$ISS.Body.Region%in% c('ABD','ARM','CHEST','CS','EXT','FACE','LEG','LS','NECK','TS') & !is.na(d$AIS.Severity) & d$AIS.Severity != 9 &  d$AIS.Severity>2,1,ifelse(d$ISS.Body.Region%in% c('ABD','ARM','CHEST','CS','EXT','FACE','LEG','LS','NECK','TS') & !is.na(d$AIS.Severity) & d$AIS.Severity != 9 &  d$AIS.Severity<=2,0,NA))
d$othertrunkinj<-ifelse( d$ISS.Body.Region%in% c('ABD','CHEST','CS','LS','TS') & !is.na(d$AIS.Severity) & d$AIS.Severity != 9 &  d$AIS.Severity>2,1,ifelse(d$ISS.Body.Region%in% c('ABD','CHEST','CS','LS','TS') & !is.na(d$AIS.Severity) & d$AIS.Severity != 9 &  d$AIS.Severity<=2,0,NA))
d$rbc<-ifelse(is.na(d$Packed.Red.Blood.Cells..4.Hours.) |d$Packed.Red.Blood.Cells..4.Hours.==0,0,ifelse(d$Packed.Red.Blood.Cells..4.Hours.==1,1,d$Packed.Red.Blood.Cells..4.Hours.))
d$rbc<-d$rbc/300
d$wb<-ifelse(is.na(d$Whole.Blood..4.Hours.) | d$Whole.Blood..4.Hours.==0,0,ifelse(d$Whole.Blood..4.Hours.==1,1,d$Whole.Blood..4.Hours.))
d$wb<-d$wb/500
d$plasma<-ifelse(is.na(d$Transfusion.Plasma..4.Hours.) | d$Transfusion.Plasma..4.Hours.==0,0,d$Transfusion.Plasma..4.Hours.)
d$plasma<-d$plasma/200
d$plt<-ifelse(is.na(d$Transfusion.Platelets..4.Hours.) | d$Transfusion.Platelets..4.Hours.==0,0,d$Transfusion.Platelets..4.Hours.)
d$plt<-d$plt/100
d$blood<-d$rbc+d$wb+d$plasma+d$plt
d$issgt9<-ifelse(is.na(d$Calculated.ISS),NA,ifelse(d$Calculated.ISS>9,1,0))
d_2 <- d %>%
group_by(FIN) %>%
mutate(
tbi_c = ifelse(any(tbi == 1, na.rm = TRUE), 1, 0),
anyotherinj_c = ifelse(any(anyotherinj == 1, na.rm = TRUE), 1, 0),
othertrunkinj_c = ifelse(any(othertrunkinj == 1, na.rm = TRUE), 1, 0),
ais.gt.2 = ifelse(any(AIS.Severity > 2, na.rm = TRUE), 1, 0),
exclude = ifelse(any(substr(ICD.10.Injury.Diagnoses..after.2016., 1, 5) == "S06.A",
# & mdy(Injury.Date) >= as.Date("2016-01-01"),
na.rm = TRUE), 1, 0)
) %>%
ungroup()
ids.exclude<-d_2$FIN[d_2$exclude==1]
ids.exclude<-ids.exclude[!is.na(ids.exclude)]
ids.exclude<-ids.exclude[!duplicated(ids.exclude)]
ids.exclude
d_3<-d_2[!is.na(d_2$Injury.Date) ,]
#dim(d_3)
d_3<-d_3[!d_3$FIN%in%ids.exclude,]
d_4<-d_3%>%filter(!(Trauma.Type=="BURN" | Trauma.Type=="P" | Interfacility.Transfer=="Y"))
#d_5 <- d_4
d_5 <- d_4
d_5$FIN[duplicated(d_5$FIN)]
d_5<-d_5[!duplicated(d_5$FIN),]
length(unique(d_2$FIN))
length(unique(d_3$FIN))
length(unique(d_4$FIN))
length(unique(d_5$FIN))
d_all<-d_5
ais_vars<-d_all[, grepl("^Max", names(d_all))]
d_all$aisgt2 <- as.integer(rowSums(ais_vars > 2, na.rm = TRUE) > 0)
d_all$year<-year(mdy(d_all$Injury.Date))
d_all<-d_all%>%mutate(tbiiso=ifelse(tbi_c==1 & anyotherinj_c==0,1,0), tbihs=ifelse(blood>3 & tbi_c==1 & othertrunkinj_c==1,1,0),hsonly=ifelse(tbi_c!=1 & blood>3 & othertrunkinj_c==1,1,0), notbinohs=ifelse(Calculated.ISS<15 & blood<=3 & tbi_c!=1,1,0),group=ifelse(tbiiso==1,1,ifelse(tbihs==1,2,ifelse(hsonly==1,3,ifelse(notbinohs==1,4,NA)))))
d_all%>%select(tbi_c,anyotherinj_c, blood,othertrunkinj_c,Calculated.ISS,Max.AIS.Head)%>%tbl_summary()
d_all$group.f<-factor(d_all$group,level = c(1,2,3,4),labels=c("Isolated TBI","TBI+HS","HS","Ortho"))
d_all%>%select(group.f)%>%tbl_summary()
dim(d_all)
dim(d_4)
dim(d_3)
d_check<-d_all%>%filter(is.na(group.f))%>%select(year,tbi_c,anyotherinj_c, blood,othertrunkinj_c,Calculated.ISS,Max.AIS.Head)
d_check %>%tbl_summary(missing="ifany")
summary(d_check$blood)
names(d_all)
d_all$ED...Hospital.Arrival.Date
d_all$ED...Hospital.Arrival.Time
d_all$arrival.time<-ymd(d_all$ED...Hospital.Arrival.Date)+hm(d_all$ED...Hospital.Arrival.Time)
?hm
hm(d_all$ED...Hospital.Arrival.Time)
ymd(d_all$ED...Hospital.Arrival.Date)
d_all$ED...Hospital.Arrival.Date
mdy(d_all$ED...Hospital.Arrival.Date)
mdy(d_all$ED...Hospital.Arrival.Date)+hm(d_all$ED...Hospital.Arrival.Time)
d_all$arrival.time<-mdy(d_all$ED...Hospital.Arrival.Date)+hm(d_all$ED...Hospital.Arrival.Time)
names(d_all)
d_all$Hospital.Physical.Discharge.Time
d_all$discharge.time<-mdy(d_all$Hospital.Physical.Discharge.Date)+hm(d_all$Hospital.Physical.Discharge.Time)
mdy(d_all$Hospital.Physical.Discharge.Date)
hm(d_all$Hospital.Physical.Discharge.Time)
d_all$Hospital.Physical.Discharge.Time
mdy(d_all$Hospital.Physical.Discharge.Date)
d_all$MRN[c(42,79)]
sum(d_all$ED.Discharge.Disposition=="D")
d_all[d_all$ED.Discharge.Disposition=="D",c("ED...Hospital.Arrival.Date","ED...Hospital.Arrival.Time","ED.Discharge.Physical.Date","ED.Discharge.Physical.Time")]
data.frame(d_all[d_all$ED.Discharge.Disposition=="D",c("ED...Hospital.Arrival.Date","ED...Hospital.Arrival.Time","ED.Discharge.Physical.Date","ED.Discharge.Physical.Time")])
# exclude deaths in the ED
ids.ed.death<-d_all$FIN[d_all$ED.Discharge.Disposition=="D"]
d_all$hosp.stay<-interval(d_all$arrival.time,d_all$discharge.time)/hours(1)
d_all$hosp.stay
ids.ed.death
d_all$death24h<-ifelse(d_all$Hospital.Discharge.Disposition=="D"& d_all$hosp.stay<24,1,0)
sum(d_all$death24h)
sum(d_all$death24h,na.rm=T)
d_all$death24h<-ifelse(d_all$Hospital.Discharge.Disposition=="D"& d_all$hosp.stay<24,1,0)
d_final<-d_all%>%filter(!FIN%in%ids.ed.death & death24h!=1)
d_final%>%select(group.f)%>%tbl_summary()
d_final<-d_all%>%filter(!FIN%in%ids.ed.death & death24h!=1 & !is.na(TEG..MAX.AMP))
d_final%>%select(group.f)%>%tbl_summary()
d_final$ED.Eye <- as.numeric(ifelse(d_final$ED.Eye == "NOT", NA, d_final$ED.Eye))
d_final$ED.Verbal <- as.numeric(ifelse(d_final$ED.Verbal == "NOT", NA, d_final$ED.Verbal))
d_final$ED.Motor <- as.numeric(ifelse(d_final$ED.Motor == "NOT", NA, d_final$ED.Motor))
d_final$ED.SBP <- as.numeric(ifelse(d_final$ED.SBP == "NOT", NA, d_final$ED.SBP))
d_final$ED.Pulse <- as.numeric(ifelse(d_final$ED.Pulse == "NOT", NA, d_final$ED.Pulse))
d_final$ED.Resp <- as.numeric(ifelse(d_final$ED.Resp == "NOT", NA, d_final$ED.Resp))
d_final <- d_final %>%
mutate(across(c(Hgb, Hct, Platelets, TEG.ACT, TEG.SPLIT.POINT,
TEG..R.TIME, TEG..K.TIME, TEG..ANGLE, TEG..MAX.AMP,
TEG..G.VALUE, TEG....LYSIS),
~ as.numeric(ifelse(. == "NOT" | . == "UNK", NA, .))))
d_final$Race<-ifelse(d_final$Race=="UNK",NA,d_final$Race)
d_final$race.f<-factor(d_final$Race)
levels(d_final$race.f)<-c("Asian","Black","Other","Other","Other","Other","White")
d_final$Ethnicity<-ifelse(d_final$Ethnicity=="UNK",NA,d_final$Ethnicity)
d_final$ethn<-factor(d_final$Ethnicity,levels = c("H", "N","NOT"),labels=c("Hispanic","Non-Hispanic","Non-Hispanic"))
d_final$BMI<-d_final$Weight_Kg/((d_final$Height_Cm/100)^2)
d_final$Blood.pH<-as.numeric(d_final$Blood.pH)
d_final$ED.O2.SAT<-as.numeric(d_final$ED.O2.SAT)
d_final$ICP.Monitor<-factor(d_final$TBI.Cerebral.Monitor,levels = c( "IVC","None","PM"),labels = c("IVC","None","PM"))
d_final$midline<-ifelse(d_final$TBI.Midline.Shift=="NI" |d_final$TBI.Midline.Shift=="NA",NA,d_final$TBI.Midline.Shift)
d_final$midline<-factor(d_final$midline)
d_final$base.excess<-as.numeric(d_final$Base.Excess.Deficit)
d_final$inj_mech<-ifelse(d_final$Mechanism%in%c("ASSAULT", "ATV", "BIKE","CRUSHING", "FALL", "MACHI", "MCC", "MVC", "OV", "PED", "SPORT"),"Blunt",ifelse(d_final$Mechanism%in%c("GSW"),"Penetrating",ifelse(d_final$Mechanism%in%c("DIVE", "EXP", "HANG", "OTHER", "WTA"),"Other",NA)))
d_final$FALL<-ifelse(d_final$Mechanism=="FALL",1,0)
d_final$mvc<-ifelse(d_final$Mechanism%in%c("ATV", "BIKE", "MCC", "MVC", "OV","PED"),1,0)
d_final$Scene.O2Sat<-as.numeric(d_final$Scene.O2Sat)
d_final$Scene.Resp<-as.numeric(d_final$Scene.Resp)
d_final$Scene.Pulse<-as.numeric(d_final$Scene.Pulse)
d_final$Scene.SBP<-as.numeric(d_final$Scene.SBP)
d_final$ED_Pupillary_resp<-d_final$TBI.Initial.ED...Hospital.Pupillary.Response
var_label(d_final)<-list(race.f="Race",ethn="Ethnicity",ED.GCS.Total="ED GCS Total",Height_Cm="Height, cm",Weight_Kg="Weight, kg",Mechanism="Injury mechanism",Transport.Mode="Transportation",ED.SBP="ED SBP",ED.Pulse="ED Pulse",ED.Resp="ED Respiratory rate",ED.Resp.Assist="ED Resp assistance",ED.O2.SAT="ED O2 Saturation",ICP.Monitor="TBI ICP Monitor",midline="TBI Midline shift",base.excess="Base excess deficit",inj_mech="Injury mechanism",FALL="Fall",mvc="Motor vehicle",Calculated.ISS="ISS")
d_inj<-d%>%filter(!is.na(ICD.10.Injury.Diagnoses..after.2016.))%>%select(MRN,FIN,Injuries,ICD.10.Injury.Diagnoses..after.2016.,ICD.10.Description,AIS.Predot.Code,AIS.Severity,ISS.Body.Region)
d_inj_ich<-d_inj%>%group_by(FIN)%>%select(FIN,ICD.10.Injury.Diagnoses..after.2016.)%>%summarise(ich=ifelse(any(substr(ICD.10.Injury.Diagnoses..after.2016.,1,6)%in%c( "S06.34", "S06.35","S06.36","S06.37","S06.38")) , 1, 0),  tbi_concussion=ifelse(any(substr(ICD.10.Injury.Diagnoses..after.2016.,1,5)=="S06.0"),1,0),tbi_edema=ifelse(any(substr(ICD.10.Injury.Diagnoses..after.2016.,1,5)=="S06.1"),1,0), tbi_diffuse=ifelse(any(substr(ICD.10.Injury.Diagnoses..after.2016.,1,5)=="S06.2"),1,0),tbi_focal=ifelse(any(substr(ICD.10.Injury.Diagnoses..after.2016.,1,5)=="S06.3"),1,0), tbi_epi_hemo=ifelse(any(substr(ICD.10.Injury.Diagnoses..after.2016.,1,5)=="S06.4"),1,0), tbi_subdural_hemo=ifelse(any(substr(ICD.10.Injury.Diagnoses..after.2016.,1,5)=="S06.5"),1,0), tbi_subarach_hemo=ifelse(any(substr(ICD.10.Injury.Diagnoses..after.2016.,1,5)=="S06.6"),1,0), tbi_oth_specified=ifelse(any(substr(ICD.10.Injury.Diagnoses..after.2016.,1,5)=="S06.8"),1,0),  tbi_oth_unspecified=ifelse(any(substr(ICD.10.Injury.Diagnoses..after.2016.,1,5)=="S06.9"),1,0), tbi_comp_hern=ifelse(any(substr(ICD.10.Injury.Diagnoses..after.2016.,1,5)=="S06.A"),1,0))
var_label(d_inj_ich)<-list(tbi_concussion="Concussion",
tbi_edema="Traumatic cerebral edema", tbi_diffuse="Diffuse TBI",
tbi_focal="Focal TBI",
tbi_epi_hemo= "Epidural hemorrhage",
tbi_subdural_hemo="Traumatic subdural hemorrhage",tbi_subarach_hemo="Traumatic subarachnoid hemorrhage",
tbi_oth_specified="Other specified intracranial injuries",
tbi_oth_unspecified="Unspecified intracranial injury",
tbi_comp_hern="Traumatic brain compression and herniation",
ich="Intracranial hemorrhage"
)
final_data<-left_join(d_final,d_inj_ich,by="FIN")
final_data%>%filter(!is.na(group.f) )%>%select(group.f)%>%tbl_summary()
t12<-final_data%>%filter(!is.na(group.f))%>%select(group.f,inj_mech,FALL,mvc,"Max.AIS.Head", "Max.AIS.Face","Max.AIS.Neck", "Max.AIS.Chest", "Max.AIS.Abdomen", "Max.AIS.Spine","Max.AIS.Upper.Extremity","Max.AIS.Lower.Extremity", "Max.AIS.External",Calculated.ISS)%>%tbl_summary(by=group.f,type=starts_with("Max")~"continuous", missing_text = "Missing") %>% as_flex_table()%>%width(width=1.5) %>%set_caption(caption="Table 2. Injury characteristics")%>%flextable::padding(padding.top = .5,padding.bottom = 1,  part = "all")
t12
d_1 <- read.csv("C:/Users/cpedroza/OneDrive - UTHealth Houston/Cox/FPA/Data/DataRequest_121823_WADE_UNIVERSAL.csv",na=c("","NA","UNK","unk","NOT"))
d_1 <- d_1 %>%
fill(MRN,FIN, .direction = "down")
d_1<- d_1 %>%
rename(
Max.AIS.Head = Max.Head.AIS.code,
Max.AIS.Face = Max.Face.AIS.Code,
Max.AIS.Neck = Max.Neck.AIS,
Max.AIS.Chest = Max.Chest.AIS,
Max.AIS.Abdomen = Max.Abdomen.AIS,
Max.AIS.Spine = Max.Spine.AIS,
Max.AIS.Upper.Extremity = Max.Upper.Extremity.AIS,
Max.AIS.Lower.Extremity = Max.Lower.Extremity.AIS,
Max.AIS.External = Max.External.AIS
)
unique(d_1$ISS.Body.Region)
d_pull <- read.csv("C:/Users/cpedroza/OneDrive - UTHealth Houston/Cox/FPA/Data/FIN_Pull_WADE_UNIVERSAL.csv",na=c("","NA","UNK","unk","NOT"))
unique(d_pull$ISS.Body.Region)
rm(list=ls())
d_1 <- read.csv("C:/Users/cpedroza/OneDrive - UTHealth Houston/Cox/FPA/Data/DataRequest_121823_WADE_UNIVERSAL.csv",na=c("","NA","UNK","unk","NOT"))
d_ais<-read.csv("~/UT HEALTH/FPA/UNIVERSAL_MAX_AIS_REGION.csv")
d_pull <- read.csv("C:/Users/cpedroza/OneDrive - UTHealth Houston/Cox/FPA/Data/FIN_Pull_WADE_UNIVERSAL.csv",na=c("","NA","UNK","unk","NOT"))
d_1 <- d_1 %>%
fill(MRN,FIN, .direction = "down")
year(d_1$Injury.Date)
year(mdy(d_1$Injury.Date))
unique(year(mdy(d_1$Injury.Date)))
table(year(mdy(d_1$Injury.Date)))
table(year(mdy(d_pull$Injury.Date)))
d_new <- read.csv("C:/Users/cpedroza/OneDrive - UTHealth Houston/Cox/FPA/Data/Data042524_WADE_UNIVERSAL_MRN.csv",skip = 8,na=c("","NA","UNK","unk","NOT"))
table(year(mdy(d_new$Injury.Date)))
unique(d_new$ISS.Body.Region)
unique(d_1$ISS.Body.Region)
unique(d_pull$ISS.Body.Region)
reg1<-unique(d_new$ISS.Body.Region)
reg2<-unique(d_1$ISS.Body.Region)
reg3<-unique(d_pull$ISS.Body.Region)
reg1%in%reg2
reg1
intersect(reg1,reg2)
!intersect(reg1,reg2)
?intersect
setdiff(reg1,reg2)
setdiff(reg2,reg3)
setdiff(reg1,reg3)
setdiff(reg3,reg1)
setdiff(reg3,reg2)
setdiff(reg2,reg3)
reg1
d_new$Injury.Date[year(mdy(d_new$Injury.Date))==2011]
q()
library(MASS)
# From article, median (IQR)
# 165.0 (77.0-280.0)
mu=117
s2=135^2
n=mu^2/(s2-mu)
p=n/(n+mu)
ysamp<-rnbinom(10000,size=n,mu=mu)
summary(ysamp)
mu=117
s2=130^2
n=mu^2/(s2-mu)
p=n/(n+mu)
ysamp<-rnbinom(10000,size=n,mu=mu)
summary(ysamp)
mu=117
s2=138^2
n=mu^2/(s2-mu)
p=n/(n+mu)
ysamp<-rnbinom(10000,size=n,mu=mu)
summary(ysamp)
mu2=mu*.58
s2.2=s2*.18
n2=mu2^2/(s2.2-mu2)
ysamp<-rnbinom(10000,size=n2,mu=mu2)
summary(ysamp)
mu=117
s2=135^2
n=mu^2/(s2-mu)
p=n/(n+mu)
ysamp<-rnbinom(10000,size=n,mu=mu)
summary(ysamp)
mu2=mu*.58
s2.2=s2*.18
n2=mu2^2/(s2.2-mu2)
ysamp<-rnbinom(10000,size=n2,mu=mu2)
summary(ysamp)
mu=117
s2=135^2
n=mu^2/(s2-mu)
p=n/(n+mu)
ysamp<-rnbinom(10000,size=n,mu=mu)
summary(ysamp)
mu2=mu*.58
s2.2=s2*.18
n2=mu2^2/(s2.2-mu2)
ysamp<-rnbinom(10000,size=n2,mu=mu2)
summary(ysamp)
mu=117
s2=135^2
n=mu^2/(s2-mu)
p=n/(n+mu)
ysamp<-rnbinom(10000,size=n,mu=mu)
summary(ysamp)
mu=117
s2=138^2
n=mu^2/(s2-mu)
p=n/(n+mu)
ysamp<-rnbinom(10000,size=n,mu=mu)
summary(ysamp)
mu=117
s2=140^2
n=mu^2/(s2-mu)
p=n/(n+mu)
ysamp<-rnbinom(10000,size=n,mu=mu)
summary(ysamp)
mu=117
s2=143^2
n=mu^2/(s2-mu)
p=n/(n+mu)
ysamp<-rnbinom(10000,size=n,mu=mu)
summary(ysamp)
mu=117
s2=143^2
n=mu^2/(s2-mu)
p=n/(n+mu)
ysamp<-rnbinom(10000,size=n,mu=mu)
summary(ysamp)
mu=117
s2=135^2
n=mu^2/(s2-mu)
p=n/(n+mu)
ysamp<-rnbinom(10000,size=n,mu=mu)
summary(ysamp)
117-48
48/117
1-.41
117*.59
.59^2
1/.59^2
mu2=mu*.59
s2.2=s2*.18
n2=mu2^2/(s2.2-mu2)
ysamp<-rnbinom(10000,size=n2,mu=mu2)
summary(ysamp)
65-48
s2.2
s2
.58^2
mu2=mu*.59
s2.2=s2*.35
n2=mu2^2/(s2.2-mu2)
ysamp<-rnbinom(10000,size=n2,mu=mu2)
summary(ysamp)
117-69
ngroup=60
nsim<-1000
res<-rep(NA,nsim)
for(i in 1:nsim){
y1<-rnbinom(ngroup,size=n,mu=mu)
y2<-rnbinom(ngroup,size=n2,mu=mu2)
d1<-data.frame(y=c(y1,y2),group=rep(c(0,1),each=ngroup))
m1<-glm.nb(y~group,data=d1,link=log)
res[i]<-summary(m1)$coef[2,4]<.05
}
mean(res)
ngroup=70
nsim<-1000
res<-rep(NA,nsim)
for(i in 1:nsim){
y1<-rnbinom(ngroup,size=n,mu=mu)
y2<-rnbinom(ngroup,size=n2,mu=mu2)
d1<-data.frame(y=c(y1,y2),group=rep(c(0,1),each=ngroup))
m1<-glm.nb(y~group,data=d1,link=log)
res[i]<-summary(m1)$coef[2,4]<.05
}
mean(res)
y1<-rnbinom(ngroup,size=n,mu=mu)
y2<-rnbinom(ngroup,size=n2,mu=mu2)
d1<-data.frame(y=c(y1,y2),group=rep(c(0,1),each=ngroup))
m1<-glm.nb(y~group,data=d1,link=log)
summary(m1)
summary(m1)$coef
summary(m1)$coef["group",4]
summary(m1)$coef["group",]
names(summary(m1)$coef)
ngroup=80
nsim<-1000
res<-rep(NA,nsim)
for(i in 1:nsim){
y1<-rnbinom(ngroup,size=n,mu=mu)
y2<-rnbinom(ngroup,size=n2,mu=mu2)
d1<-data.frame(y=c(y1,y2),group=rep(c(0,1),each=ngroup))
m1<-glm.nb(y~group,data=d1,link=log)
res[i]<-summary(m1)$coef["group",4]<.05
}
mean(res)
ngroup=80
nsim<-3000
res<-rep(NA,nsim)
for(i in 1:nsim){
y1<-rnbinom(ngroup,size=n,mu=mu)
y2<-rnbinom(ngroup,size=n2,mu=mu2)
d1<-data.frame(y=c(y1,y2),group=rep(c(0,1),each=ngroup))
m1<-glm.nb(y~group,data=d1,link=log)
res[i]<-summary(m1)$coef["group",4]<.05
}
mean(res)
ngroup=78
nsim<-3000
res<-rep(NA,nsim)
for(i in 1:nsim){
y1<-rnbinom(ngroup,size=n,mu=mu)
y2<-rnbinom(ngroup,size=n2,mu=mu2)
d1<-data.frame(y=c(y1,y2),group=rep(c(0,1),each=ngroup))
m1<-glm.nb(y~group,data=d1,link=log)
res[i]<-summary(m1)$coef["group",4]<.05
}
mean(res)
ngroup=75
nsim<-3000
res<-rep(NA,nsim)
for(i in 1:nsim){
y1<-rnbinom(ngroup,size=n,mu=mu)
y2<-rnbinom(ngroup,size=n2,mu=mu2)
d1<-data.frame(y=c(y1,y2),group=rep(c(0,1),each=ngroup))
m1<-glm.nb(y~group,data=d1,link=log)
res[i]<-summary(m1)$coef["group",4]<.05
}
mean(res)
ngroup=75
nsim<-5000
res<-rep(NA,nsim)
for(i in 1:nsim){
y1<-rnbinom(ngroup,size=n,mu=mu)
y2<-rnbinom(ngroup,size=n2,mu=mu2)
d1<-data.frame(y=c(y1,y2),group=rep(c(0,1),each=ngroup))
m1<-glm.nb(y~group,data=d1,link=log)
res[i]<-summary(m1)$coef["group",4]<.05
}
mean(res)
117-58
mu2=mu*.59
s2.2=s2*.35
n2=mu2^2/(s2.2-mu2)
ysamp<-rnbinom(10000,size=n2,mu=mu2)
summary(ysamp)
sd(ysamp)
68/78
117/135
68/.87
sqrt(s2)/mu
sqrt(s2.2)/mu2
mu2*sqrt(s2)/mu
sqrt(s2.2)
s2.2= (mu2*sqrt(s2)/mu)^2
n2=mu2^2/(s2.2-mu2)
ysamp<-rnbinom(10000,size=n2,mu=mu2)
summary(ysamp)
q()
